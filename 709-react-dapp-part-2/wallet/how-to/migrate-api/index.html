<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-how-to/migrate-api">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Migrate the provider API | MetaMask docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.metamask.io/709-react-dapp-part-2/wallet/how-to/migrate-api"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Migrate the provider API | MetaMask docs"><meta data-rh="true" name="description" content="Migrate to the current provider API."><meta data-rh="true" property="og:description" content="Migrate to the current provider API."><link data-rh="true" rel="icon" href="/709-react-dapp-part-2/img/metamask-fox.svg"><link data-rh="true" rel="canonical" href="https://docs.metamask.io/709-react-dapp-part-2/wallet/how-to/migrate-api"><link data-rh="true" rel="alternate" href="https://docs.metamask.io/709-react-dapp-part-2/wallet/how-to/migrate-api" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.metamask.io/709-react-dapp-part-2/wallet/how-to/migrate-api" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://AWX4QVM59R-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="MetaMask docs" href="/709-react-dapp-part-2/opensearch.xml">


<script src="https://plausible.io/js/script.js" defer="defer" data-domain="docs.metamask.io"></script><link rel="stylesheet" href="/709-react-dapp-part-2/assets/css/styles.54f8b92c.css">
<link rel="preload" href="/709-react-dapp-part-2/assets/js/runtime~main.6a49d735.js" as="script">
<link rel="preload" href="/709-react-dapp-part-2/assets/js/main.251e9502.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/709-react-dapp-part-2/wallet/"><div class="navbar__logo"><img src="/709-react-dapp-part-2/img/metamask-logo.svg" alt="MetaMask logo" class="themedImage_ToTc themedImage--light_HNdA" width="150"><img src="/709-react-dapp-part-2/img/metamask-logo-dark.svg" alt="MetaMask logo" class="themedImage_ToTc themedImage--dark_i4oU" width="150"></div><b class="navbar__title text--truncate"> │ ‎ Documentation</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/709-react-dapp-part-2/wallet/">Wallet</a><a class="navbar__item navbar__link" href="/709-react-dapp-part-2/snaps/">Snaps</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/709-react-dapp-part-2/wallet/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/709-react-dapp-part-2/wallet/category/get-started">Get started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Get started&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/709-react-dapp-part-2/wallet/get-started/set-up-dev-environment">Set up your development environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/709-react-dapp-part-2/wallet/get-started/run-development-network">Run a development network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/709-react-dapp-part-2/wallet/get-started/detect-metamask">Detect MetaMask</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/709-react-dapp-part-2/wallet/get-started/detect-network">Detect a user&#x27;s network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/709-react-dapp-part-2/wallet/get-started/access-accounts">Access a user&#x27;s accounts</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/709-react-dapp-part-2/wallet/category/how-to">How to</a><button aria-label="Toggle the collapsible sidebar category &#x27;How to&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/709-react-dapp-part-2/wallet/how-to/use-sdk/">Use MetaMask SDK</a><button aria-label="Toggle the collapsible sidebar category &#x27;Use MetaMask SDK&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/709-react-dapp-part-2/wallet/how-to/use-mobile">Use MetaMask Mobile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/709-react-dapp-part-2/wallet/how-to/interact-with-smart-contracts">Interact with smart contracts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/709-react-dapp-part-2/wallet/how-to/send-transactions">Send transactions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/709-react-dapp-part-2/wallet/how-to/sign-data">Sign data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/709-react-dapp-part-2/wallet/how-to/register-token">Register a token with users</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/709-react-dapp-part-2/wallet/how-to/register-method-names">Register a contract&#x27;s method names</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/709-react-dapp-part-2/wallet/how-to/access-provider">Access a user&#x27;s MetaMask provider</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/709-react-dapp-part-2/wallet/how-to/secure-dapp">Secure your dapp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/709-react-dapp-part-2/wallet/how-to/set-icon">Set an icon</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/709-react-dapp-part-2/wallet/how-to/use-onboarding-library">Use the onboarding library</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/709-react-dapp-part-2/wallet/how-to/migrate-api">Migrate the provider API</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/709-react-dapp-part-2/wallet/category/concepts">Concepts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Concepts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/709-react-dapp-part-2/wallet/category/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/709-react-dapp-part-2/wallet/category/reference">Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Migrate to the current provider API</h1><p>In January 2021, MetaMask made a number of breaking changes to the
<a href="/709-react-dapp-part-2/wallet/reference/provider-api">provider API</a>, and removed the injected <code>window.web3</code>.
These changes are live on all platforms as of version:</p><ul><li><code>9.0.2</code> of the MetaMask browser extension.</li><li><code>1.0.9</code> of MetaMask Mobile.</li></ul><p>This guide describes how to migrate to the new provider API, and how to replace <code>window.web3</code>.
To understand why MetaMask made these changes, please see
<a href="https://medium.com/metamask/breaking-changes-to-the-metamask-provider-are-here-7b11c9388be9" target="_blank" rel="noopener noreferrer">this blog post</a>.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>If you&#x27;re a MetaMask user attempting to use a legacy Ethereum website that hasn&#x27;t migrated to the
new API, please see the <a href="#use-the-metamask-legacy-web3-extension">MetaMask legacy Web3 extension</a>.</p><p>Except for such legacy websites, no action is required for MetaMask users.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary-of-breaking-changes">Summary of breaking changes<a href="#summary-of-breaking-changes" class="hash-link" aria-label="Direct link to Summary of breaking changes" title="Direct link to Summary of breaking changes">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="windowweb3-removal"><code>window.web3</code> removal<a href="#windowweb3-removal" class="hash-link" aria-label="Direct link to windowweb3-removal" title="Direct link to windowweb3-removal">​</a></h3><p>As part of the breaking changes, MetaMask stopped injecting <code>web3.js</code> version <code>0.20.7</code> as <code>window.web3</code>
into web pages.
MetaMask still injects a dummy object at <code>window.web3</code>, in order to issue warnings when websites
attempt to access <code>window.web3</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="windowethereum-api-changes"><code>window.ethereum</code> API changes<a href="#windowethereum-api-changes" class="hash-link" aria-label="Direct link to windowethereum-api-changes" title="Direct link to windowethereum-api-changes">​</a></h3><p>MetaMask made the following breaking changes to the <code>window.ethereum</code> API:</p><ul><li>Ensure that chain IDs returned by <code>eth_chainId</code> are <strong>not</strong> 0-padded.<ul><li>For example, instead of <code>0x01</code>, we always return <code>0x1</code>, wherever the chain ID is returned or accessible.</li></ul></li><li>Stop emitting <code>chainIdChanged</code>, and instead emit <code>chainChanged</code>.</li><li>Remove the following experimental methods:<ul><li><code>ethereum._metamask.isEnabled</code></li><li><code>ethereum._metamask.isApproved</code></li></ul></li><li>Remove the <code>ethereum.publicConfigStore</code> object.<ul><li>This object was, despite its name, never intended for public consumption.
Its removal <em>may</em> affect those who do not use it directly, for example, if another library you
use relies on the object.</li></ul></li><li>Remove the <code>ethereum.autoRefreshOnNetworkChange</code> property.<ul><li>Consumers can still set this property on the provider, it just won&#x27;t do anything.</li></ul></li><li>Deprecate the <code>web3.currentProvider</code> method.<ul><li>Use <a href="https://github.com/MetaMask/detect-provider" target="_blank" rel="noopener noreferrer">@metamask/detect-provider</a> to detect the
current provider.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="replace-windowweb3">Replace <code>window.web3</code><a href="#replace-windowweb3" class="hash-link" aria-label="Direct link to replace-windowweb3" title="Direct link to replace-windowweb3">​</a></h2><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Pages no longer reload on chain changes</div><div class="admonitionContent_S0QG"><p>Since we removed <code>window.web3</code>, MetaMask no longer automatically reloads the page on chain/network changes.</p><p>Please see <a href="#handle-the-removal-of-ethereumautorefreshonnetworkchange">Handling the removal of <code>ethereum.autoRefreshOnNetworkChange</code></a>
for details.</p></div></div><p>For historical reasons, MetaMask injected <a href="https://github.com/ethereum/web3.js/tree/0.20.7" target="_blank" rel="noopener noreferrer"><code>web3@0.20.7</code></a> into all web pages.
That version of <code>web3</code> is deprecated, <a href="https://github.com/ethereum/web3.js/issues/3065" target="_blank" rel="noopener noreferrer">has known security issues</a>, and is no longer maintained by the <a href="https://github.com/ethereum/web3.js/" target="_blank" rel="noopener noreferrer">web3.js</a> team.
Therefore, we decided to remove this library.</p><p>If your website relied on our <code>window.web3</code> object, you have to migrate.
Please continue reading to understand your options.
Some are as simple as a one-line change.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Regardless of how you choose to migrate, you may want to read the <code>web3@0.20.7</code> documentation, which
you can find <a href="https://github.com/ethereum/web3.js/blob/0.20.7/DOCUMENTATION.md" target="_blank" rel="noopener noreferrer">here</a>.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-windowethereum-directly">Use <code>window.ethereum</code> directly<a href="#use-windowethereum-directly" class="hash-link" aria-label="Direct link to use-windowethereum-directly" title="Direct link to use-windowethereum-directly">​</a></h3><p>For many web3 sites, the API provided by <code>window.ethereum</code> is sufficient.
Much of the <code>web3</code> API simply maps to RPC methods, all of which can be requested using
<a href="/709-react-dapp-part-2/wallet/reference/provider-api#windowethereumrequestargs"><code>ethereum.request()</code></a>.
For example, here are a couple of actions performed using first <code>window.web3</code>, and then their
equivalents using <code>window.ethereum</code>.</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"> * Getting Accounts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// window.web3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> accounts </span><span class="token operator">=</span><span class="token plain"> web3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">eth</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">accounts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// window.ethereum</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> accounts </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> ethereum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;eth_accounts&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"> * Sending a Transaction</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// window.web3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">web3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">eth</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">sendTransaction</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">to</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;0x...&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string-property property">&#x27;from&#x27;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;0x...&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;0x...&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// And so on...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Handle the result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// window.ethereum</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> transactionHash </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> ethereum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;eth_sendTransaction&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">params</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token literal-property property">to</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;0x...&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string-property property">&#x27;from&#x27;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;0x...&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token literal-property property">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;0x...&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// And so on...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Handle the result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">transactionHash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-an-updated-convenience-library">Use an updated convenience library<a href="#use-an-updated-convenience-library" class="hash-link" aria-label="Direct link to Use an updated convenience library" title="Direct link to Use an updated convenience library">​</a></h3><p>If you decide that you need a convenience library, you have to convert your usage of <code>window.web3</code>
to an updated convenience library.
We recommend <a href="https://npmjs.com/package/ethers" target="_blank" rel="noopener noreferrer"><code>ethers</code></a> (<a href="https://docs.ethers.io/" target="_blank" rel="noopener noreferrer">documentation</a>).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-metamasklegacy-web3">Use <code>@metamask/legacy-web3</code><a href="#use-metamasklegacy-web3" class="hash-link" aria-label="Direct link to use-metamasklegacy-web3" title="Direct link to use-metamasklegacy-web3">​</a></h3><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>We strongly recommend that you consider one of the other two migration paths before resorting to this one.
It is not future-proof, and we will not add new features to it.</p></div></div><p>Finally, if you just want your web3 site to continue to work, we created
<a href="https://npmjs.com/package/@metamask/legacy-web3" target="_blank" rel="noopener noreferrer"><code>@metamask/legacy-web3</code></a>.
This package is a drop-in replacement for our <code>window.web3</code> that you can add to your website even
before remove <code>window.web3</code> on all platforms.</p><p><code>@metamask/legacy-web3</code> should work exactly like our injected <code>window.web3</code>, including by refreshing
the page on chain/network changes, but <em>we cannot guarantee that it works perfectly</em>.
We will not fix any future incompatibilities between <code>web3@0.20.7</code> and MetaMask itself, nor will we
fix any bugs in <code>web3@0.20.7</code> itself.</p><p>For installation and usage instructions, please see the
<a href="https://npmjs.com/package/@metamask/legacy-web3" target="_blank" rel="noopener noreferrer">npm listing</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-the-metamask-legacy-web3-extension">Use the MetaMask legacy Web3 extension<a href="#use-the-metamask-legacy-web3-extension" class="hash-link" aria-label="Direct link to Use the MetaMask legacy Web3 extension" title="Direct link to Use the MetaMask legacy Web3 extension">​</a></h3><p>We created the <a href="https://github.com/MetaMask/legacy-web3-extension" target="_blank" rel="noopener noreferrer"><strong>MetaMask Legacy Web3 Extension</strong></a>
for any users of websites that still expect <code>window.web3</code> to be injected.
If you install this extension alongside the regular MetaMask wallet extension, websites that rely on
our old window.web3 API should start working again.</p><p>As with the regular extension, it’s critical that you only install from the official browser
extension stores.
Please follow the relevant link below to install the Legacy Web3 extension in your browser:</p><ul><li><a href="https://microsoftedge.microsoft.com/addons/detail/metamask-legacy-web3/obkfjbjkiofoponpkmphnpaaadebfloh?hl=en-US" target="_blank" rel="noopener noreferrer">Edge</a></li><li><a href="https://addons.mozilla.org/en-US/firefox/addon/metamask-legacy-web3/" target="_blank" rel="noopener noreferrer">Firefox</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrate-to-the-new-provider-api">Migrate to the new provider API<a href="#migrate-to-the-new-provider-api" class="hash-link" aria-label="Direct link to Migrate to the new provider API" title="Direct link to Migrate to the new provider API">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="handle-eth_chainid-return-values">Handle <code>eth_chainId</code> return values<a href="#handle-eth_chainid-return-values" class="hash-link" aria-label="Direct link to handle-eth_chainid-return-values" title="Direct link to handle-eth_chainid-return-values">​</a></h3><p>The <code>eth_chainId</code> RPC method now returns correctly formatted values, e.g. <code>0x1</code> and <code>0x2</code>, instead
of <em>incorrectly</em> formatted values, e.g. <code>0x01</code> and <code>0x02</code>.
MetaMask&#x27;s implementation of <code>eth_chainId</code> used to return 0-padded values for the
<a href="/709-react-dapp-part-2/wallet/get-started/detect-network#chain-ids">default Ethereum chains</a> <em>except</em> Kovan.
If you expect 0-padded chain ID values from <code>eth_chainId</code>, make sure to update your code to expect
the correct format instead.</p><p>For more details on chain IDs and how to handle them, see the
<a href="/709-react-dapp-part-2/wallet/reference/provider-api#chainchanged"><code>chainChanged</code> event</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="handle-the-removal-of-chainidchanged">Handle the removal of <code>chainIdChanged</code><a href="#handle-the-removal-of-chainidchanged" class="hash-link" aria-label="Direct link to handle-the-removal-of-chainidchanged" title="Direct link to handle-the-removal-of-chainidchanged">​</a></h3><p><code>chainIdChanged</code> is a typo of <code>chainChanged</code>.
To migrate, simply listen for <code>chainChanged</code> instead:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Instead of this:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ethereum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">on</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;chainIdChanged&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">chainId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">/* handle the chainId */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Do this:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ethereum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">on</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;chainChanged&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">chainId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">/* handle the chainId */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="handle-the-removal-of-isenabled-and-isapproved">Handle the removal of <code>isEnabled()</code> and <code>isApproved()</code><a href="#handle-the-removal-of-isenabled-and-isapproved" class="hash-link" aria-label="Direct link to handle-the-removal-of-isenabled-and-isapproved" title="Direct link to handle-the-removal-of-isenabled-and-isapproved">​</a></h3><p>Before the new provider API shipped, we added the <code>_metamask.isEnabled</code> and <code>_metamask.isApproved</code>
methods to enable web3 sites to check if they have
<a href="/709-react-dapp-part-2/wallet/reference/rpc-api#eth_requestaccounts">access to the user&#x27;s accounts</a>.
<code>isEnabled</code> and <code>isApproved</code> functioned identically, except that <code>isApproved</code> was <code>async</code>.
These methods were arguably never that useful, and they became completely redundant with the
introduction of MetaMask&#x27;s <a href="/709-react-dapp-part-2/wallet/reference/rpc-api#restricted-methods">permission system</a>.</p><p>We recommend that you check for account access in the following ways:</p><ol><li>You can call the <a href="/709-react-dapp-part-2/wallet/reference/rpc-api#wallet_getpermissions"><code>wallet_getPermissions</code></a> RPC method
and check for the <code>eth_accounts</code> permission.</li><li>You can call the <code>eth_accounts</code> RPC method and the
<a href="/709-react-dapp-part-2/wallet/reference/provider-api#windowethereum_metamaskisunlocked"><code>ethereum._metamask.isUnlocked()</code></a> method.<ul><li>MetaMask has to be unlocked before you can access the user&#x27;s accounts.
If the array returned by <code>eth_accounts</code> is empty, check if MetaMask is locked using <code>isUnlocked()</code>.</li><li>If MetaMask is unlocked and you still aren&#x27;t receiving any accounts, it&#x27;s time to request
accounts using the <a href="/709-react-dapp-part-2/wallet/reference/rpc-api#eth_requestaccounts"><code>eth_requestAccounts</code> RPC method</a>.</li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="handle-the-removal-of-ethereumpublicconfigstore">Handle the removal of <code>ethereum.publicConfigStore</code><a href="#handle-the-removal-of-ethereumpublicconfigstore" class="hash-link" aria-label="Direct link to handle-the-removal-of-ethereumpublicconfigstore" title="Direct link to handle-the-removal-of-ethereumpublicconfigstore">​</a></h3><p>How to handle this change depends on if and how you relied on the <code>publicConfigStore</code>.
We have seen examples of listening for provider state changes the <code>publicConfigStore</code> <code>data</code> event,
and accessing the <code>publicConfigStore</code> internal state directly.</p><p>We recommend that you search your code and its dependencies for references to <code>publicConfigStore</code>.
If you find any references, you should understand what it&#x27;s being used for, and migrate to
<a href="/709-react-dapp-part-2/wallet/reference/provider-api">one of the recommended provider APIs</a> instead.
If you don&#x27;t find any references, you should not be affected by this change.</p><p>Although it is possible that your dependencies use the <code>publicConfigStore</code>, we have confirmed that
the latest versions (as of January 2021) of the following common libraries were not affected by this
change:</p><ul><li><code>ethers</code></li><li><code>web3</code> (web3.js)</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="handle-the-removal-of-ethereumautorefreshonnetworkchange">Handle the removal of <code>ethereum.autoRefreshOnNetworkChange</code><a href="#handle-the-removal-of-ethereumautorefreshonnetworkchange" class="hash-link" aria-label="Direct link to handle-the-removal-of-ethereumautorefreshonnetworkchange" title="Direct link to handle-the-removal-of-ethereumautorefreshonnetworkchange">​</a></h3><p>The <code>ethereum.autoRefreshOnNetworkChange</code> was a mutable boolean property used to control whether
MetaMask reloaded the page on chain/network changes.
However, it only caused the page to be reloaded if the script access a property on <code>window.web3</code>.
Therefore, this property was removed along with <code>window.web3</code>.</p><p>Despite this, we still recommend reloading the page on chain changes.
Some convenience libraries, such as <a href="https://www.npmjs.com/package/ethers" target="_blank" rel="noopener noreferrer">ethers</a>, will continue to
reload the page by default.
If you don&#x27;t use such a convenience library, you&#x27;ll have to reload the page manually.
Please see the <a href="/709-react-dapp-part-2/wallet/reference/provider-api#chainchanged"><code>chainChanged</code> event</a> for details.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/709-react-dapp-part-2/wallet/how-to/use-onboarding-library"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Use the onboarding library</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/709-react-dapp-part-2/wallet/category/concepts"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Concepts</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary-of-breaking-changes" class="table-of-contents__link toc-highlight">Summary of breaking changes</a><ul><li><a href="#windowweb3-removal" class="table-of-contents__link toc-highlight"><code>window.web3</code> removal</a></li><li><a href="#windowethereum-api-changes" class="table-of-contents__link toc-highlight"><code>window.ethereum</code> API changes</a></li></ul></li><li><a href="#replace-windowweb3" class="table-of-contents__link toc-highlight">Replace <code>window.web3</code></a><ul><li><a href="#use-windowethereum-directly" class="table-of-contents__link toc-highlight">Use <code>window.ethereum</code> directly</a></li><li><a href="#use-an-updated-convenience-library" class="table-of-contents__link toc-highlight">Use an updated convenience library</a></li><li><a href="#use-metamasklegacy-web3" class="table-of-contents__link toc-highlight">Use <code>@metamask/legacy-web3</code></a></li><li><a href="#use-the-metamask-legacy-web3-extension" class="table-of-contents__link toc-highlight">Use the MetaMask legacy Web3 extension</a></li></ul></li><li><a href="#migrate-to-the-new-provider-api" class="table-of-contents__link toc-highlight">Migrate to the new provider API</a><ul><li><a href="#handle-eth_chainid-return-values" class="table-of-contents__link toc-highlight">Handle <code>eth_chainId</code> return values</a></li><li><a href="#handle-the-removal-of-chainidchanged" class="table-of-contents__link toc-highlight">Handle the removal of <code>chainIdChanged</code></a></li><li><a href="#handle-the-removal-of-isenabled-and-isapproved" class="table-of-contents__link toc-highlight">Handle the removal of <code>isEnabled()</code> and <code>isApproved()</code></a></li><li><a href="#handle-the-removal-of-ethereumpublicconfigstore" class="table-of-contents__link toc-highlight">Handle the removal of <code>ethereum.publicConfigStore</code></a></li><li><a href="#handle-the-removal-of-ethereumautorefreshonnetworkchange" class="table-of-contents__link toc-highlight">Handle the removal of <code>ethereum.autoRefreshOnNetworkChange</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Wallet</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/709-react-dapp-part-2/wallet">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/709-react-dapp-part-2/wallet/category/get-started">Get started</a></li><li class="footer__item"><a class="footer__link-item" href="/709-react-dapp-part-2/wallet/category/how-to">How to guides</a></li><li class="footer__item"><a class="footer__link-item" href="/709-react-dapp-part-2/wallet/category/tutorials">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/709-react-dapp-part-2/wallet/category/reference">Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Snaps</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/709-react-dapp-part-2/snaps">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/709-react-dapp-part-2/snaps/category/get-started">Get started</a></li><li class="footer__item"><a class="footer__link-item" href="/709-react-dapp-part-2/snaps/category/how-to">How to guides</a></li><li class="footer__item"><a class="footer__link-item" href="/709-react-dapp-part-2/snaps/category/tutorials">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/709-react-dapp-part-2/snaps/category/reference">Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/consensys" target="_blank" rel="noopener noreferrer" class="footer__link-item">ConsenSys Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/MetaMask/metamask-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/MetaMask/metamask-extension/" target="_blank" rel="noopener noreferrer" class="footer__link-item">MetaMask wallet GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/MetaMask/snaps-monorepo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Snaps GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://consensys.net/privacy-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://consensys.net/terms-of-use/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://metamask.io/cla/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contributor License Agreement<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://metamask.io/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/709-react-dapp-part-2/img/metamask-logo.svg" alt="MetaMask logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo" width="250"><img src="/709-react-dapp-part-2/img/metamask-logo-dark.svg" alt="MetaMask logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" width="250"></a></div><div class="footer__copyright">© 2023 MetaMask • A ConsenSys Formation</div></div></div></footer></div>
<script src="/709-react-dapp-part-2/assets/js/runtime~main.6a49d735.js"></script>
<script src="/709-react-dapp-part-2/assets/js/main.251e9502.js"></script>
</body>
</html>