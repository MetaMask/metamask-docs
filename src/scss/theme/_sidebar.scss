.menu {
  /* Sidebar "guide line" (vertical tree line) color */
  --doc-sidebar-guide-line-color: var(--ifm-toc-border-color);

  &.thin-scrollbar {
    padding: 1rem 0 0;
  }

  .navbar-sidebar__back {
    background-color: transparent;
    margin-top: 1.4rem;

    @include bp-max('tablet') {
      padding-left: 2.1rem;
    }
  }

  &__list {
    padding-top: 0;
    padding-bottom: 0;

    @include bp('tablet') {
      padding-top: 0.5rem;
      padding-bottom: 1rem;
    }

    .theme-doc-sidebar-item-category-level-1 & {
      padding-left: calc(var(--ifm-menu-link-padding-horizontal) / 4);

      @include bp('tablet') {
        padding-left: var(--ifm-menu-link-padding-horizontal);
      }
    }

    .theme-doc-sidebar-item-category-level-2 &,
    .theme-doc-sidebar-item-category-level-3 &,
    .theme-doc-sidebar-item-category-level-4 &,
    .theme-doc-sidebar-item-category-level-5 &,
    .theme-doc-sidebar-item-category-level-6 & {
      padding-left: calc(var(--ifm-menu-link-padding-horizontal) / 4);

      @include bp('tablet') {
        padding-left: calc(var(--ifm-menu-link-padding-horizontal) / 2);
        padding-top: 0;
        padding-bottom: 0;
      }
    }
    .menu__list {
      flex: 0 0 100%;
      padding-top: 0rem;
      padding-bottom: 0rem;
      margin-bottom: 0.25rem;
      padding-left: var(--ifm-menu-link-padding-horizontal);
    }

    /* Vertical guide lines (tree lines) for expanded category trees (level 1+). */
    .menu__list-item.theme-doc-sidebar-item-category-level-1 > .menu__list,
    .menu__list-item.theme-doc-sidebar-item-category-level-2 > .menu__list,
    .menu__list-item.theme-doc-sidebar-item-category-level-3 > .menu__list,
    .menu__list-item.theme-doc-sidebar-item-category-level-4 > .menu__list,
    .menu__list-item.theme-doc-sidebar-item-category-level-5 > .menu__list,
    .menu__list-item.theme-doc-sidebar-item-category-level-6 > .menu__list {
      position: relative;

      &::before {
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        left: 1.6rem; /* align with default link text start */
        width: 1px;
        background: var(--doc-sidebar-guide-line-color);
        pointer-events: none;
        opacity: 0;
      }

      @include bp('tablet') {
        &::before {
          left: 2.4rem; /* align with tablet link text start */
        }
      }
    }

    .menu__list-item.theme-doc-sidebar-item-category-level-1:not(.menu__list-item--collapsed) > .menu__list::before,
    .menu__list-item.theme-doc-sidebar-item-category-level-2:not(.menu__list-item--collapsed) > .menu__list::before,
    .menu__list-item.theme-doc-sidebar-item-category-level-3:not(.menu__list-item--collapsed) > .menu__list::before,
    .menu__list-item.theme-doc-sidebar-item-category-level-4:not(.menu__list-item--collapsed) > .menu__list::before,
    .menu__list-item.theme-doc-sidebar-item-category-level-5:not(.menu__list-item--collapsed) > .menu__list::before,
    .menu__list-item.theme-doc-sidebar-item-category-level-6:not(.menu__list-item--collapsed) > .menu__list::before {
      opacity: 1;
    }
    .theme-doc-sidebar-item-link-level-1 {
      padding-bottom: 0.4rem;
    }
    .theme-doc-sidebar-item-category-level-1 {
      padding-bottom: 0.4rem;
    }
  }

  &__list-item {
    position: relative;
    z-index: 1;

    /* Reduce top-level nav emphasis (level 1). */
    &.theme-doc-sidebar-item-category-level-1 > .menu__list-item-collapsible > .menu__link {
      font-size: 1.5rem;
      font-weight: 400;
    }

    /* Top-level doc pages (e.g. "Introduction") are link items, not categories. */
    &.theme-doc-sidebar-item-link-level-1 > .menu__link {
      font-size: 1.5rem;
      font-weight: 400;
    }

    /* Active page + active ancestor path: bold for clearer orientation. */
    &.menu__list-item--active > .menu__list-item-collapsible > .menu__link,
    &.menu__list-item--active > .menu__link {
      color: var(--ifm-menu-color-active);
      font-weight: 700 !important;
      /* Ensure it still *looks* bold even if the font doesn't ship a true 700 weight */
      text-shadow: 0 0 0 currentColor;
    }

    &-collapsible {
      border-radius: 0;
    }

    /* Hover: no background/bar (TOC-like). Only a subtle text emphasis. */
    &-collapsible:hover {
      background-image: none !important;
      background-color: transparent !important;
      background: transparent !important; /* override Infima `background:` shorthand */
    }

    /* Active (expanded category row): no bar, no filled background, just typography */
    &-collapsible--active {
      background-image: none !important;
      background-color: transparent !important;
      background: transparent !important; /* override Infima `background:` shorthand */
    }

    /* Apply the subtle hover emphasis to the text inside collapsible rows */
    &-collapsible:hover .menu__link {
      color: var(--ifm-menu-color-active);
      /* Faux-bold without reflow (more stable than font-weight changes) */
      text-shadow: 0 0 0 currentColor;
    }

    &.theme-doc-sidebar-item-category-level-2,
    &.theme-doc-sidebar-item-category-level-3,
    &.theme-doc-sidebar-item-category-level-4,
    &.theme-doc-sidebar-item-category-level-5,
    &.theme-doc-sidebar-item-category-level-6,
    &.theme-doc-sidebar-item-link-level-2,
    &.theme-doc-sidebar-item-link-level-3,
    &.theme-doc-sidebar-item-link-level-4,
    &.theme-doc-sidebar-item-link-level-5,
    &.theme-doc-sidebar-item-link-level-6 {
      a {
        color: var(--ifm-menu-color);
        font-weight: 400;
        font-size: 1.5rem;
      }

      &:not(:first-child) {
        margin-top: 0rem;
      }
    }

    &:not(
        :first-child,
        .theme-doc-sidebar-item-link-level-2,
        .theme-doc-sidebar-item-link-level-3,
        .theme-doc-sidebar-item-link-level-4,
        .theme-doc-sidebar-item-link-level-5,
        .theme-doc-sidebar-item-link-level-6
      ) {
      margin-top: 0rem;
    }
  }

  &__link {
    color: var(--ifm-menu-color-active);
    font-size: 1.7rem;
    line-height: 124%;
    text-decoration: none;
    font-weight: 500;
    padding: 0.6rem 1.6rem;
    border-radius: 0;
    text-decoration: none !important;

    @include bp('tablet') {
      padding: 0.6rem 2.4rem;
    }

    &--active {
      color: var(--ifm-menu-color-active);
      font-weight: 700 !important;
      /* Ensure it still *looks* bold even if the font doesn't ship a true 700 weight */
      text-shadow: 0 0 0 currentColor;
      /* Selected item: no bar / no filled background */
      background-image: none !important;
      background-color: transparent !important;

      + .menu__caret {
        opacity: 1;
      }
    }

    /* Hover: slight contrast, no "highlight bar" */
    &:hover,
    &:focus-visible {
      background-image: none !important;
      background-color: transparent !important;
      background: transparent !important; /* override Infima `background:` shorthand */
      color: var(--ifm-menu-color-active);
      /* Faux-bold without reflow (more stable than font-weight changes) */
      text-shadow: 0 0 0 currentColor;
    }
  }

  &__caret {
    padding: 1rem 2rem 1rem 1rem;
    opacity: 0.25;

    &::before {
      background: var(--ifm-menu-link-sublist-icon);
      background-repeat: no-repeat;
      background-size: contain;
      height: 0.7rem;
      width: 0.9rem;
      content: '';
    }
  }

  &__link--active + &__caret::before {
    opacity: 1;
  }

  &__link--non-collapsible {
    cursor: default;
  }


}

/* Dark mode: make tree lines more subtle */
[data-theme='dark'] .menu {
  --doc-sidebar-guide-line-color: rgba(255, 255, 255, 0.12);
}

.theme-doc-sidebar-container {
  @include bp-max('desktop') {
    border-right: none !important;
  }
}

.navbar-sidebar {
  @include bp-max('tablet') {
    &__brand {
      padding: 0 var(--page-padding-x);
    }
  }
}
